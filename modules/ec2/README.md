# EC2モジュール

## 概要
このTerraformモジュールは、指定されたAWS環境内でEC2インスタンスをプロビジョニングします。ユーザー定義の入力に基づいてインスタンスの数を変更可能なように設計されており、柔軟性とスケーラビリティを提供します。

## 特徴
- **動的インスタンス数**: デプロイするインスタンスの数を指定できます。
- **サブネットの柔軟性**: インスタンスはラウンドロビン方式で複数のサブネットに分散してデプロイされ、高可用性と負荷分散を実現します。
- **セキュリティグループ統合**: インスタンスに一つまたは複数のセキュリティグループを関連付けることができます。
- **誤っての終了防止**: インスタンスが誤って終了されるのを防ぐオプションがあります。
- **ライフサイクル管理**: 更新中にインスタンスが破棄される前に新しいインスタンスが作成されることを保証し、ダウンタイムを最小限に抑えます。

## モジュール入力
- `instance_count`: デプロイするインスタンスの数。
- `ami`: インスタンスに使用されるAmazonマシンイメージ（AMI）ID。
- `instance_type`: インスタンスのタイプ（例: t2.micro、m5.large）。
- `key_name`: インスタンスにアタッチされたキーペアの名前（SSHアクセス用）。
- `subnets`: インスタンスが起動されるサブネットIDのリスト。複数のサブネットにインスタンスを分散させます。
- `security_group_ids`: 各インスタンスに関連付けられるセキュリティグループIDのリスト。
- `disable_api_termination`: 真の場合、インスタンスが誤って終了されるのを防ぎます。
- `system`: システムに対するユーザー定義の識別子。
- `env`: 環境タグ（例: prod、dev、staging）。リソースのタグ付けや分離に使用されます。

## 使用方法
このモジュールをTerraform設定に含め、必要な入力を提供することで使用します。以下は基本的な例です：

```hcl
module "ec2_instances" {
  source                = "../modules/ec2"
  instance_count        = 3
  ami                   = "ami-0c55b159cbfafe1f0"
  instance_type         = "t3.medium"
  key_name              = "my-key-pair"
  subnets               = ["subnet-abcde123", "subnet-12345abc", "subnet-a1b2c3d4"]
  security_group_ids    = ["sg-01abcde2345f6789a", "sg-02abcde2345f6789b"]
  disable_api_termination = true
  system                = "my-app"
  env                   = "prod"
}
```

## 追加情報
- 提供されたAMI IDおよびサブネットIDが、あなたのAWSアカウントおよびリージョンで有効かつ利用可能であることを確認してください。
- セキュリティグループは、アプリケーションの要件に基づいて適切なトラフィックを許可および制限するように設定する必要があります。
- このモジュール内のリソースのライフサイクルポリシーを管理することで、データ損失やサービスの中断なく、スムーズな遷移とアップデートを実現できます。

詳細な設定や変更については、Terraformのメインドキュメントまたは各入力パラメータに関連するAWSリソースのドキュメントを参照してください。
